# üö¥‚Äç‚ôÇÔ∏è VeloGraph: –î–æ—Ä–æ–∂–Ω—è –ö–∞—Ä—Ç–∞ –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

## üì¶ –§–∞–∑–∞ 0: –Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Infrastructure)
*–ú–µ—Ç–∞: –ü—ñ–¥–Ω—è—Ç–∏ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ, –¥–µ –∂–∏–≤–µ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö —Ç–∞ API.*

- [x] **–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ—î–∫—Ç—É**
  - [x] –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π —Ç–∞ `.gitignore` (Python)
  - [x] `uv sync` (Python 3.14+)
  - [x] –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫:
    ```text
    velograph/
    ‚îú‚îÄ‚îÄ app/                # FastAPI –∫–æ–¥
    ‚îú‚îÄ‚îÄ data_pipeline/      # ETL —Å–∫—Ä–∏–ø—Ç–∏
    ‚îú‚îÄ‚îÄ manuals/            # PDF —Ñ–∞–π–ª–∏
    ‚îî‚îÄ‚îÄ docker-compose.yml
    ```
- [x] **Docker Environment**
  - [x] –ù–∞–ø–∏—Å–∞—Ç–∏ `docker-compose.yml`
  - [x] –î–æ–¥–∞—Ç–∏ —Å–µ—Ä–≤—ñ—Å **Elasticsearch** (v9.x, –≤–∏–º–∫–Ω—É—Ç–∏ xpack security –¥–ª—è dev)
  - [x] –î–æ–¥–∞—Ç–∏ —Å–µ—Ä–≤—ñ—Å **Kibana** (–¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —ñ–Ω–¥–µ–∫—Å—ñ–≤)
- [x] **Basic Connectivity**
  - [x] –ù–∞–ø–∏—Å–∞—Ç–∏ `app/core/db.py` –¥–ª—è –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ ES —á–µ—Ä–µ–∑ `AsyncElasticsearch`.

---

## üìÑ –§–∞–∑–∞ 1: ETL –ü–∞–π–ø–ª–∞–π–Ω (Data Ingestion)
*–ú–µ—Ç–∞: –ù–∞–≤—á–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É —á–∏—Ç–∞—Ç–∏ PDF –º–∞–Ω—É–∞–ª–∏ —Ç–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —ó—Ö –Ω–∞ –≤–µ–∫—Ç–æ—Ä–∏.*

- [x] **–ó–±—ñ—Ä –¥–∞–Ω–∏—Ö**
  - [x] –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ñ PDF:
    - [x] *Shimano Product Compatibility Information*
    - [x] *Shimano Specification Handbook*
    - [x] *Shimano Products Line-up Chart*
- [ ] **–ü–∞—Ä—Å–∏–Ω–≥ (Parsing)**
  - [x] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏: `pymupdf` (fitz), `langchain`, `openai`.
  - [x] –ù–∞–ø–∏—Å–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç –µ–∫—Å—Ç—Ä–∞–∫—Ü—ñ—ó —Ç–µ–∫—Å—Ç—É (–∑–±–µ—Ä—ñ–≥–∞—é—á–∏ –Ω–æ–º–µ—Ä–∏ —Å—Ç–æ—Ä—ñ–Ω–æ–∫).
- [x] **Chunking (–ù–∞—Ä—ñ–∑–∫–∞)**
  - [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `RecursiveCharacterTextSplitter`.
  - [x] *–ó–∞–¥–∞—á–∞ —ñ–∑ –∑—ñ—Ä–æ—á–∫–æ—é:* –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ regex –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–∑–≤ –º–æ–¥–µ–ª–µ–π (–Ω–∞–ø—Ä. `RD-RX810`) —ñ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —ó—Ö —É –º–µ—Ç–∞–¥–∞–Ω—ñ.
- [ ] **Embedding & Indexing**
  - [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ OpenAI Embeddings (`text-embedding-3-small`).
  - [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–Ω–¥–µ–∫—Å –≤ ES –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º –º–∞–ø–ø—ñ–Ω–≥–æ–º (`dense_vector` + `keyword`).
  - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—ó —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –º–∞–Ω—É–∞–ª–∞.

---

## üîç –§–∞–∑–∞ 2: –ü–æ—à—É–∫–æ–≤–∏–π –¥–≤–∏–≥—É–Ω (Hybrid Search)
*–ú–µ—Ç–∞: –ó–Ω–∞–π—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —à–º–∞—Ç–æ–∫ –º–∞–Ω—É–∞–ª—É.*

- [ ] **Search Logic**
  - [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é –ø–æ—à—É–∫—É –≤ `app/services/search.py`.
  - [ ] –î–æ–¥–∞—Ç–∏ **Keyword Search** (—Ñ—ñ–ª—å—Ç—Ä –ø–æ –ø–æ–ª—é `component_model`).
  - [ ] –î–æ–¥–∞—Ç–∏ **Vector Search** (kNN query –ø–æ `embedding`).
  - [ ] –û–±'—î–¥–Ω–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ (Hybrid Search).

---

## üß† –§–∞–∑–∞ 3: RAG & AI Logic
*–ú–µ—Ç–∞: –°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É.*

- [ ] **LLM Integration**
  - [ ] –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ OpenAI GPT-4o —á–µ—Ä–µ–∑ –∫–ª—ñ—î–Ω—Ç –∞–±–æ LangChain.
- [ ] **Prompt Engineering**
  - [ ] –†–æ–∑—Ä–æ–±–∏—Ç–∏ System Prompt ("You are an expert bicycle mechanic...").
  - [ ] –î–æ–¥–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó —â–æ–¥–æ "—Å—É–≤–æ—Ä–∏—Ö –æ–±–º–µ–∂–µ–Ω—å" (Capacity, Max Sprocket).
- [ ] **RAG Pipeline**
  - [ ] –ó—ñ–±—Ä–∞—Ç–∏ –ª–∞–Ω—Ü—é–∂–æ–∫: `Query -> Search ES -> Context -> LLM -> Answer`.

---

## üîå –§–∞–∑–∞ 4: API Layer (FastAPI)
*–ú–µ—Ç–∞: –í—ñ–¥–¥–∞—Ç–∏ —Ü–µ —Å–≤—ñ—Ç—É —á–µ—Ä–µ–∑ REST API.*

- [ ] **API Structure**
  - [ ] Endpoint `POST /api/v1/compatibility/check`:
    - Input: `{ "component_a": "...", "component_b": "..." }`
    - Output: `{ "status": "...", "reason": "...", "sources": [...] }`
  - [ ] Endpoint `POST /api/v1/ingest` (Admin): –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö PDF.
- [ ] **Error Handling**
  - [ ] –û–±—Ä–æ–±–∫–∞ –≤–∏–ø–∞–¥–∫—ñ–≤, –∫–æ–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑—ñ.

---

## üé® –§–∞–∑–∞ 5: Frontend (MVP)
*–ú–µ—Ç–∞: –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.*

- [ ] **Setup**
  - [ ] Next.js –∞–±–æ –ø—Ä–æ—Å—Ç–∏–π Jinja2 templates (—è–∫—â–æ —Ö–æ—á–µ—Ç—å—Å—è –∑–∞–ª–∏—à–∏—Ç–∏—Å—å –≤ Python).
- [ ] **UI Components**
  - [ ] –§–æ—Ä–º–∞ —É–≤–æ–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤.
  - [ ] –ö–∞—Ä—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É (–ó–µ–ª–µ–Ω–∏–π/–ñ–æ–≤—Ç–∏–π/–ß–µ—Ä–≤–æ–Ω–∏–π —Å—Ç–∞—Ç—É—Å).
  - [ ] –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ü–∏—Ç–∞—Ç (Source Text) –∑ PDF.
